# Проект SSO (Single Sign-On)

Этот проект представляет собой систему единого входа (SSO), реализованную на языке Go. Он предоставляет функционал для аутентификации пользователей и управления ими через gRPC API и SQLite базу данных, которую можно заменить на любую другую из-за гибкой структуры проекта.

## Особенности

- Аутентификация пользователей через gRPC.
- Регистрация новых пользователей.
- Проверка прав администратора для пользователей.
- В качестве токена аутентификации используется JWT.
- Поддержка миграций базы данных.
- Конфигурация через YAML файл.
- В проекте присутствуют функциональные тесты. (**В РАЗРАБОТКЕ**)
- В проекте используется [самописный хэндлер](https://github.com/jacute/prettylogger) для пакета log/slog.

## Структура проекта

- `cmd/`: Основные исполняемые файлы приложения.
  - `migrator/`: Скрипт для применения миграций базы данных.
  - `sso/`: Основной исполняемый файл приложения SSO.

- `config/`: Конфигурационные файлы.
  - `local.yaml`: Пример конфигурации для локальной разработки.

- `internal/`: Внутренние пакеты приложения.
  - `app/`: Логика приложения и gRPC сервер.
  - `config/`: Загрузка и управление конфигурацией.
  - `domain/models/`: Модели данных.
  - `grpc/`: Маршрутный слой проекта.
  - `lib/`: Библиотеки и утилиты (в данном случае здесь jwt и валидаторы).
  - `services/`: Сервисный слой проекта.
  - `storage/`: Реализация хранения данных.

- `migrations/`: SQL-скрипты для миграций базы данных.

- `storage/`: Директория для хранения SQLite базы данных.

- `tests/`: Тесты приложения.

- `Makefile`: Инструменты для сборки и управления проектом.

## Установка и запуск

### Требования

- [Go](https://golang.org/doc/install) (версия 1.18 или выше)

### Клонирование репозитория

```bash
git clone https://github.com/ваш-репозиторий/sso.git
cd sso
```

### Установка зависимостей

```bash
go mod tidy
```

### Приминение миграций

```bash
make migrate
```

### Запуск приложения

```bash
make run-local
```

## Конфигурация

Конфигурация приложения находится в файле `config/local.yaml`. Вы можете изменить следующие параметры:

- `env`: Среда выполнения (`local`, `dev`, `prod`).
- `storage_path`: Путь к файлу базы данных.
- `token_ttl`: Время жизни токенов.
- `grpc`: Конфигурация gRPC.

## Использование

### gRPC API

Приложение предоставляет gRPC API для следующих операций:

- `Login`: Аутентификация пользователя.
- `Register`: Регистрация нового пользователя.
- `IsAdmin`: Проверка, является ли пользователь администратором.

Интерфейсы и методы описаны в [протоколе gRPC](https://github.com/jacute/protos).

### Миграции базы данных

Скрипты миграций находятся в каталоге `migrations`. Используйте команду `make migrate` для применения всех миграций.